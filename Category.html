<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh m·ª•c s·∫£n ph·∫©m - ElectroShop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .header {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: white;
            padding: 10px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .top-bar {
            background: #000;
            padding: 8px 0;
            font-size: 13px;
        }

        .top-bar .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .top-bar a {
            color: #fff;
            text-decoration: none;
            margin: 0 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ff6b00 0%, #ffa500 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
        }

        .logo-text {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(135deg, #ff6b00 0%, #ffa500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            margin: 0 30px;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 12px 50px 12px 20px;
            border: 2px solid #ff6b00;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
        }

        .search-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #ff6b00 0%, #ffa500 100%);
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }

        .header-actions {
            display: flex;
            gap: 25px;
            align-items: center;
        }

        .header-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            position: relative;
        }

        .cart-badge {
            position: absolute;
            top: -5px;
            right: -8px;
            background: #ff0000;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
        }

        .breadcrumb {
            background: white;
            padding: 15px 0;
            margin-bottom: 20px;
        }

        .breadcrumb a {
            color: #666;
            text-decoration: none;
            margin: 0 5px;
        }

        .breadcrumb a:hover {
            color: #ff6b00;
        }

        .categories-section {
            background: white;
            padding: 40px 20px;
            border-radius: 15px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 40px;
        }

        .categories-title {
            font-size: 26px;
            font-weight: bold;
            margin-bottom: 25px;
            color: #1a1a1a;
            text-align: center;
            background: linear-gradient(135deg, #ff6b00 0%, #ffa500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }

        .category-card {
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .category-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(255, 107, 0, 0.3);
        }

        .category-card.active {
            border: 2px solid #ff6b00;
            background-color: #fff5e6;
        }

        .category-card .cat-img {
            width: 100%;
            height: 180px;
            background: linear-gradient(135deg, #ff6b00 0%, #ffa500 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
        }

        .category-card h3 {
            padding: 15px 0;
            font-size: 18px;
            font-weight: 600;
            color: #333;
            background: #fff;
        }

        .category-banner {
            background: linear-gradient(135deg, #ff6b00 0%, #ffa500 100%);
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .banner-content h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }

        .banner-content p {
            font-size: 16px;
            opacity: 0.95;
        }

        .banner-icon {
            font-size: 100px;
            opacity: 0.3;
        }

        .category-container {
            display: flex;
            gap: 20px;
        }

        .sidebar {
            background: white;
            border-radius: 15px;
            width: 250px;
            padding: 25px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
            flex-shrink: 0;
        }

        .filter-section {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 2px solid #f5f5f5;
        }

        .filter-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .filter-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #1a1a1a;
        }

        .filter-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .filter-option {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .filter-option:hover {
            background: #f8f8f8;
        }

        .filter-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .filter-option label {
            flex: 1;
            cursor: pointer;
            font-size: 14px;
        }

        .filter-count {
            color: #999;
            font-size: 13px;
        }

        .price-range {
            margin-top: 15px;
        }

        .price-inputs {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .price-input {
            flex: 1;
            padding: 10px;
            font-size: 14px;
            border: 2px solid #ddd;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
        }

        .price-input:focus {
            border-color: #ff6b00;
            outline: none;
        }

        .btn-filter {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #ff6b00 0%, #ffa500 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }

        .btn-filter:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 0, 0.3);
        }

        .btn-reset {
            width: 100%;
            padding: 12px;
            background: white;
            color: #ff6b00;
            border: 2px solid #ff6b00;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        .main-content {
            flex: 1;
        }

        .category-header {
            background: white;
            padding: 20px 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        }

        .results-count {
            font-size: 16px;
            color: #666;
            font-weight: bold;
        }

        .category-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .view-toggle {
            display: flex;
            gap: 5px;
        }

        .view-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
        }

        .view-btn.active {
            border-color: #ff6b00;
            background: #fff5e6;
            color: #ff6b00;
        }

        .sort-select {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            background: white;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
        }

        .products-grid.list-view {
            grid-template-columns: 1fr;
        }

        .product-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(255, 107, 0, 0.3);
        }

        .products-grid.list-view .product-card {
            display: grid;
            grid-template-columns: 200px 1fr;
        }

        .product-image {
            width: 100%;
            height: 250px;
            background: #f8f8f8;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            position: relative;
            overflow: hidden;
        }

        .product-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            display: block;
            margin: auto;
        }

        .products-grid.list-view .product-image {
            height: 200px;
        }

        .product-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #ff0000;
            color: white;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
        }

        .product-badge.sale {
            background: #ff0000;
        }

        .product-badge.new {
            background: #4CAF50;
        }

        .product-badge.hot {
            background: #ff6b00;
        }

        .wishlist-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }

        .wishlist-btn:hover {
            transform: scale(1.1);
            background: #ff6b00;
        }

        .product-info {
            padding: 20px;
        }

        .product-brand {
            font-size: 12px;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .product-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            height: 40px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .product-specs {
            font-size: 13px;
            color: #666;
            margin-bottom: 12px;
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .price-current {
            font-size: 24px;
            color: #ff6b00;
            font-weight: bold;
        }

        .price-old {
            font-size: 16px;
            color: #999;
            text-decoration: line-through;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .stars {
            color: #ffa500;
        }

        .rating-count {
            color: #999;
        }

        .product-actions {
            display: flex;
            gap: 10px;
        }

        .btn-add-cart {
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, #ff6b00 0%, #ffa500 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-add-cart:hover {
            transform: scale(1.05);
        }

        .btn-quick-view {
            width: 45px;
            height: 45px;
            background: white;
            border: 2px solid #ff6b00;
            color: #ff6b00;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
        }

        .mobile-filter-btn {
            display: none;
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #ff6b00 0%, #ffa500 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: bold;
            margin-bottom: 20px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .category-container {
                flex-direction: column;
            }

            .sidebar {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 1000;
                width: 100%;
                overflow-y: auto;
            }

            .sidebar.active {
                display: block;
            }

            .mobile-filter-btn {
                display: block;
            }

            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .products-grid.list-view {
                grid-template-columns: 1fr;
            }

            .category-banner {
                padding: 30px 20px;
            }

            .banner-icon {
                display: none;
            }

            .categories-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <div class="top-bar">
        <div class="top-bar">
            <div class="container">
                <span id="authStatusArea">
                </span>
            </div>
        </div>
    </div>

    <header class="header">
        <div class="container">
            <div class="header-main">
                <div class="logo">
                    <div class="logo-icon">‚ö°</div>
                    <div class="logo-text">ElectroShop</div>
                </div>

                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..."
                        onkeypress="handleSearchKey(event)">
                    <button class="search-btn" onclick="performSearch()">T√¨m</button>
                </div>

                <div class="header-actions">
                    <div class="header-action">
                        <div style="font-size: 24px;">üì±</div>
                        <div style="font-size: 12px;">Hotline</div>
                    </div>
                    <div class="header-action" id="accountBtn" style="cursor: pointer;">
                        <div style="font-size: 24px;">üë§</div>
                        <div style="font-size: 12px;">T√†i kho·∫£n</div>
                    </div>
                    <a href="cart.html" class="header-action"
                        style="text-decoration: none; color: inherit; position: relative;">
                        <div style="font-size: 24px;">üõí</div>
                        <div style="font-size: 12px;" href="cart.html"></div>Gi·ªè h√†ng
                </div>

                </a>
            </div>
        </div>
        </div>
    </header>


    <div class="breadcrumb">
        <div class="container" id="breadcrumbContent">
            <a href="index.html">Trang ch·ªß</a>
            <span></span>
        </div>
    </div>

    <main class="container">
        <div class="category-banner">
            <div class="banner-content" id="bannerContent">
                <h1>B·ªô s∆∞u t·∫≠p</h1>
                <p>Mang ƒë·∫øn cho b·∫°n nh·ªØng s·∫£n ph·∫©m sang tr·ªçng v·ªõi ch·∫•t l∆∞·ª£ng v∆∞·ª£t tr·ªôi</p>
            </div>
            <div class="banner-icon"></div>
        </div>

        <section class="categories-section container">
            <h2 class="categories-title">Danh m·ª•c s·∫£n ph·∫©m</h2>
            <div class="categories-grid">
                <div class="category-card" data-category="dienthoai">
                    <div class="cat-img">üì±</div>
                    <h3>ƒêi·ªán tho·∫°i</h3>
                </div>
                <div class="category-card" data-category="laptop">
                    <div class="cat-img">üíª</div>
                    <h3>Laptop</h3>
                </div>
                <div class="category-card" data-category="maytinhbang">
                    <div class="cat-img">üì±</div>
                    <h3>M√°y t√≠nh b·∫£ng</h3>
                </div>
                <div class="category-card" data-category="phukien">
                    <div class="cat-img">üéß</div>
                    <h3>Ph·ª• ki·ªán</h3>
                </div>
            </div>
        </section>

        <button class="mobile-filter-btn" onclick="toggleMobileFilter()">
        </button>
        <div class="category-container">
            <aside class="sidebar" id="sidebar" style="display: none;">
                <div class="filter-section" id="filter-dienthoai" style="display: none;">
                    <h3 class="filter-title">Th∆∞∆°ng hi·ªáu</h3>
                    <div class="filter-options">
                        <div class="filter-option">
                            <input type="checkbox" class="filter-brand" id="phonebrand1" value="apple">
                            <label for="phonebrand1">Apple</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" class="filter-brand" id="phonebrand2" value="samsung">
                            <label for="phonebrand2">Samsung</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" class="filter-brand" id="phonebrand3" value="xiaomi">
                            <label for="phonebrand3">Xiaomi</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" class="filter-brand" id="phonebrand4" value="oppo">
                            <label for="phonebrand4">OPPO</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" class="filter-brand" id="phonebrand5" value="vivo">
                            <label for="phonebrand5">Vivo</label>
                        </div>
                    </div>

                    <h3 class="filter-title">Kho·∫£ng gi√°</h3>
                    <div class="price-range">
                        <div class="price-inputs">
                            <input type="number" class="price-input filter-price-min" placeholder="T·ª´" value="0">
                            <span>-</span>
                            <input type="number" class="price-input filter-price-max" placeholder="ƒê·∫øn"
                                value="50000000">
                        </div>
                    </div>

                    <h3 class="filter-title">Dung l∆∞·ª£ng</h3>
                    <div class="filter-options">
                        <div class="filter-option">
                            <input type="checkbox" class="filter-storage" id="phonestorage1" value="64GB">
                            <label for="phonestorage1">64GB</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" class="filter-storage" id="phonestorage2" value="128GB">
                            <label for="phonestorage2">128GB</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" class="filter-storage" id="phonestorage3" value="256GB">
                            <label for="phonestorage3">256GB</label>
                        </div>
                    </div>

                    <h3 class="filter-title">RAM</h3>
                    <div class="filter-options">
                        <div class="filter-option">
                            <input type="checkbox" class="filter-ram" id="phoneram1" value="4GB">
                            <label for="phoneram1">4GB</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" class="filter-ram" id="phoneram2" value="6GB">
                            <label for="phoneram2">6GB</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" class="filter-ram" id="phoneram3" value="8GB">
                            <label for="phoneram3">8GB</label>
                        </div>
                    </div>

                    <button class="btn-filter" onclick="applyFilters()">√Åp d·ª•ng</button>
                    <button class="btn-reset" onclick="resetFilters()">ƒê·∫∑t l·∫°i</button>
                </div>

                <div class="filter-section" id="filter-laptop" style="display: none;">
                    <h3 class="filter-title">Th∆∞∆°ng hi·ªáu</h3>
                    <div class="filter-options">
                        <div class="filter-option">
                            <input type="checkbox" class="filter-brand" id="laptopbrand1" value="apple">
                            <label for="laptopbrand1">MacBook</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" class="filter-brand" id="laptopbrand2" value="dell">
                            <label for="laptopbrand2">Dell</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" class="filter-brand" id="laptopbrand3" value="asus">
                            <label for="laptopbrand3">HP</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" class="filter-brand" id="laptopbrand4" value="hp">
                            <label for="laptopbrand4">Asus</label>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" class="filter-brand" id="laptopbrand5" value="lenovo">
                            <label for="laptopbrand5">Lenovo</label>
                        </div>
                    </div>

                    <h3 class="filter-title">Kho·∫£ng gi√°</h3>
                    <div class="price-range">
                        <div class="price-inputs">
                            <input type="number" class="price-input filter-price-min" placeholder="T·ª´" value="0">
                            <span>-</span>
                            <input type="number" class="price-input filter-price-max" placeholder="ƒê·∫øn"
                                value="100000000">
                        </div>
                    </div>

                    <h3 class="filter-title">CPU</h3>
                    <div class="filter-options">
                        <div class="filter-option">
                            <input type="checkbox" id="laptopCPU1" value="Intel i3">
                            <label for="laptopCPU1">Intel i3</label>
                            <span class="filter-count"></span>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="laptopCPU2" value="Intel i5">
                            <label for="laptopCPU2">Intel i5</label>
                            <span class="filter-count"></span>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="laptopCPU3" value="Intel i7">
                            <label for="laptopCPU3">Intel i7</label>
                            <span class="filter-count"></span>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="laptopCPU4" value="AMD Ryzen 5">
                            <label for="laptopCPU4">AMD Ryzen 5</label>
                            <span class="filter-count"></span>
                        </div>
                    </div>

                    <h3 class="filter-title">RAM</h3>
                    <div class="filter-options">
                        <div class="filter-option">
                            <input type="checkbox" class="filter-ram" id="laptopram1" value="8GB">
                            <label for="laptopram1">8GB</label>
                            <span class="filter-count"></span>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" class="filter-ram" id="laptopram2" value="16GB">
                            <label for="laptopram2">16GB</label>
                            <span class="filter-count"></span>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" class="filter-ram" id="laptopram3" value="32GB">
                            <label for="laptopram3">32GB</label>
                            <span class="filter-count"></span>
                        </div>
                    </div>

                    <h3 class="filter-title">·ªî c·ª©ng</h3>
                    <div class="filter-options">
                        <div class="filter-option">
                            <input type="checkbox" id="laptopSSD1" value="256GB">
                            <label for="laptopSSD1">256GB</label>
                            <span class="filter-count"></span>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="laptopSSD2" value="512GB">
                            <label for="laptopSSD2">512GB</label>
                            <span class="filter-count"></span>
                        </div>
                        <div class="filter-option">
                            <input type="checkbox" id="laptopSSD3" value="1TB">
                            <label for="laptopSSD3">1TB</label>
                            <span class="filter-count"></span>
                        </div>
                    </div>

                    <button class="btn-filter" onclick="applyFilters()">√Åp d·ª•ng</button>
                    <button class="btn-reset" onclick="resetFilters()">ƒê·∫∑t l·∫°i</button>
                </div>
            </aside>

            <div class="main-content" id="mainContent" style="display: none;">
                <div class="category-header">
                    <span class="results-count" id="resultsCount">Hi·ªÉn th·ªã <strong>0 s·∫£n ph·∫©m</strong></span>

                    <div class="category-controls">
                        <div class="view-toggle">
                            <button class="view-btn active" onclick="setGridView()" title="L∆∞·ªõi">‚äû</button>
                            <button class="view-btn" onclick="setListView()" title="Danh s√°ch">‚ò∞</button>
                        </div>
                        <select class="sort-select" onchange="sortProducts(this.value)">
                            <option value="default">S·∫Øp x·∫øp m·∫∑c ƒë·ªãnh</option>
                            <option value="price-asc">Gi√°: Th·∫•p ƒë·∫øn cao</option>
                            <option value="price-desc">Gi√°: Cao ƒë·∫øn th·∫•p</option>
                        </select>
                    </div>
                </div>

                <div class="products-grid" id="productsGrid"></div>
            </div>
        </div>
    </main>

    <script src="js/Product.js"></script>
    <script>
        const BASE_URL = 'http://localhost:5000/api';
        let currentProducts = [];
        let currentSort = 'default';
        let currentCategory = null;
        let userWishlistIds = [];

        function formatCurrency(number) {
            return number.toLocaleString('vi-VN') + '‚Ç´';
        }

        async function fetchWithAuth(url, method = 'GET', data = null) {
            const token = localStorage.getItem('userToken');
            if (!token) {
                alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ th·ª±c hi·ªán giao d·ªãch.');
                window.location.replace('login.html');
                throw new Error('No token found');
            }

            const headers = {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            };

            const config = { method, headers, };
            if (data) { config.body = JSON.stringify(data); }

            const response = await fetch(url, config);
            const result = await response.json();

            if (!response.ok) {
                throw new Error(result.message || 'L·ªói h·ªá th·ªëng');
            }
            return result;
        }

        async function fetchWishlist() {
            try {
                const result = await fetchWithAuth(`${BASE_URL}/users/wishlist`, 'GET');
                userWishlistIds = result.wishlist.map(item => item.productId);
            } catch (error) {
                console.error('L·ªói t·∫£i danh s√°ch y√™u th√≠ch:', error);
                userWishlistIds = [];
            }
        }

        async function fetchProducts(categoryKey, filters) {
            let url = `${BASE_URL}/products?category=${categoryKey}`;

            if (!categoryKey) {
                renderProducts([]);
                return;
            }

            if (filters) {
                for (const key in filters) {
                    if (filters[key] !== null && filters[key] !== undefined && filters[key] !== '') {
                        url += `&${key}=${filters[key]}`;
                    }
                }
            }

            try {
                const response = await fetch(url);
                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.message || 'L·ªói khi t·∫£i s·∫£n ph·∫©m');
                }

                currentProducts = result.products;
                await fetchWishlist();
                renderProducts(currentProducts);

            } catch (error) {
                console.error('L·ªói t·∫£i s·∫£n ph·∫©m theo danh m·ª•c:', error);
                alert('L·ªói t·∫£i s·∫£n ph·∫©m: ' + error.message);
                renderProducts([]);
            }
        }

        function createProductCard(product) {
            const isFavorited = userWishlistIds.includes(product.id);
            const oldPriceHtml = product.oldPrice ?
                `<span class="price-old">${formatCurrency(product.oldPrice)}</span>` : '';
            const badgeHtml = product.badge ? `<div class="product-badge ${product.badge}">${product.badge === 'sale' ? 'SALE' : product.badge.toUpperCase()}</div>` : '';
            const stars = '‚≠ê'.repeat(product.rating) + '‚òÜ'.repeat(5 - product.rating);

            const safeProductName = product.name.replace(/'/g, "\\'");
            const heartIcon = isFavorited ? '‚ù§Ô∏è' : 'ü§ç';

            const displayBrand = product.brand ? product.brand.toUpperCase() : 'N/A';
            const displaySpecs = product.specsSummary || 'ƒêang c·∫≠p nh·∫≠t';

            return `
        <div class="product-card" data-id="${product.id}" data-price="${product.price}" data-brand="${product.brand || ''}" data-storage="${product.storage || ''}" data-ram="${product.ram || ''} " onclick="window.location.href='Product_Detail.html?id=${product.id}'">
            <div class="product-image">
                ${badgeHtml}
                <button class="wishlist-btn" data-product-id="${product.id}" onclick="event.stopPropagation();
                    toggleWishlist(${product.id}, '${safeProductName}', this)">${heartIcon}</button>
                <img src="${product.image}" alt="${product.name}">
            </div>
            <div class="product-info">
                <div class="product-brand">${displayBrand}</div>
                <div class="product-name">${product.name}</div>
                <div class="product-specs">${displaySpecs}</div>
                <div class="product-price">
                    <span class="price-current">${formatCurrency(product.price)}</span>
                    ${oldPriceHtml}
                </div>
                <div class="product-rating">
                    <span class="stars">${stars}</span>
                    <span class="rating-count">(${Math.floor(Math.random() * 200) + 50})</span>
                </div>
                <div class="product-actions">
                    <button class="btn-add-cart" data-product-id="${product.id}" onclick="event.stopPropagation();
                    addToCart(${product.id})">Th√™m v√†o gi·ªè</button>
                    <button class="btn-quick-view" onclick="event.stopPropagation();
                    quickView(${product.id})">üëÅÔ∏è</button>
                </div>
            </div>
        </div>
    `;
        }

        function renderProducts(products) {
            const productsGrid = document.getElementById('productsGrid');
            const resultsCount = document.getElementById('resultsCount');

            if (productsGrid) productsGrid.innerHTML = products.map(createProductCard).join('');
            if (resultsCount) resultsCount.innerHTML = `Hi·ªÉn th·ªã <strong>${products.length} s·∫£n ph·∫©m</strong>`;
        }

        function getCheckedValues(className) {
            return Array.from(document.querySelectorAll(`.${className}:checked`)).map(el => el.value.toLowerCase());
        }

        function applyFilters() {
            if (!currentCategory) return;

            const minPriceInput = document.querySelector('.filter-price-min');
            const maxPriceInput = document.querySelector('.filter-price-max');

            const filters = {
                brand: getCheckedValues('filter-brand').join(','),
                ram: getCheckedValues('filter-ram').join(','),
                storage: getCheckedValues('filter-storage').join(','),
                minPrice: minPriceInput?.value || 0,
                maxPrice: maxPriceInput?.value || Infinity,
                sort: currentSort,
            };

            fetchProducts(currentCategory, filters);

            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('active');
            }
        }

        function sortProducts(sortValue) {
            currentSort = sortValue;
            applyFilters();
        }

        function setGridView() {
            const productsGrid = document.getElementById('productsGrid');
            if (productsGrid) productsGrid.classList.remove('list-view');
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.view-toggle .view-btn:first-child').classList.add('active');
        }

        function setListView() {
            const productsGrid = document.getElementById('productsGrid');
            if (productsGrid) productsGrid.classList.add('list-view');
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.view-toggle .view-btn:last-child').classList.add('active');
        }

        function resetFilters() {
            document.querySelectorAll('#sidebar input[type="checkbox"]').forEach(cb => cb.checked = false);

            const minInput = document.querySelector('.filter-price-min');
            const maxInput = document.querySelector('.filter-price-max');
            if (minInput) minInput.value = 0;
            if (maxInput) maxInput.value = '';

            document.querySelector('.sort-select').value = 'default';
            currentSort = 'default';

            applyFilters();

            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.remove('active');
            }
        }

        function toggleMobileFilter() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        async function addToCart(productId) {
            const quantity = 1;

            try {
                const result = await fetchWithAuth(`${BASE_URL}/cart/add`, 'POST', {
                    productId: parseInt(productId),
                    quantity: quantity
                });

                alert(result.message);
            } catch (error) {
                alert('‚ùå L·ªói khi th√™m v√†o gi·ªè: ' + error.message);
            }
        }

        async function toggleWishlist(id, name, buttonElement) {
            try {
                const result = await fetchWithAuth(`${BASE_URL}/users/wishlist/toggle`, 'POST', {
                    productId: parseInt(id),
                });

                const isAdded = result.action === 'added';

                buttonElement.textContent = isAdded ? '‚ù§Ô∏è' : 'ü§ç';

                if (isAdded) {
                    if (!userWishlistIds.includes(id)) {
                        userWishlistIds.push(id);
                    }
                    alert(`‚úÖ ƒê√£ th√™m s·∫£n ph·∫©m "${name}" v√†o danh s√°ch y√™u th√≠ch!`);
                } else {
                    userWishlistIds = userWishlistIds.filter(pid => pid !== id);
                    alert(`‚ùå ƒê√£ x√≥a s·∫£n ph·∫©m "${name}" kh·ªèi danh s√°ch y√™u th√≠ch.`);
                }

            } catch (error) {
                alert('‚ùå L·ªói khi c·∫≠p nh·∫≠t danh s√°ch y√™u th√≠ch: ' + error.message);
            }
        }

        function quickView(id) {
            alert(`Xem nhanh s·∫£n ph·∫©m ID ${id}`);
        }

        function performSearch() {
            const query = document.getElementById('searchInput')?.value.trim();

            if (!query) {
                renderProducts(currentProducts);
                document.getElementById('resultsCount').innerHTML = `Hi·ªÉn th·ªã <strong>${currentProducts.length}</strong> s·∫£n ph·∫©m`;
                return;
            }

            const normalize = (str) => str
                .toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/ƒë/g, 'd')
                .replace(/ƒê/g, 'D')
                .trim();

            const searchTerm = normalize(query);

            const filtered = currentProducts.filter(product => {
                const productName = normalize(product.name || '');
                return productName.includes(searchTerm);
            });

            renderProducts(filtered);
            document.getElementById('resultsCount').innerHTML = `T√¨m th·∫•y <strong>${filtered.length}</strong> s·∫£n ph·∫©m cho "<em>${query}</em>"`;
        }

        function handleSearchKey(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            const categoryCards = document.querySelectorAll('.category-card');

            categoryCards.forEach(card => {
                card.addEventListener('click', () => {
                    const mainContent = document.getElementById('mainContent');
                    if (mainContent) mainContent.style.display = "block";

                    const categoryKey = card.dataset.category;
                    currentCategory = categoryKey;
                    const categoryName = card.querySelector('h3').innerText;
                    const breadcrumbContent = document.getElementById('breadcrumbContent');

                    if (breadcrumbContent) breadcrumbContent.innerHTML = `<a href="index.html">Trang ch·ªß</a> / <span>${categoryName}</span>`;
                    categoryCards.forEach(c => c.classList.remove('active'));
                    card.classList.add('active');

                    const filterSections = {
                        'dienthoai': document.getElementById('filter-dienthoai'),
                        'laptop': document.getElementById('filter-laptop')
                    };
                    const sidebar = document.getElementById('sidebar');

                    Object.values(filterSections).forEach(f => {
                        if (f) f.style.display = 'none';
                    });
                    if (filterSections[categoryKey]) {
                        if (sidebar) sidebar.style.display = 'block';
                        filterSections[categoryKey].style.display = 'block';
                    } else {
                        if (sidebar) sidebar.style.display = 'none';
                    }

                    document.querySelectorAll('#sidebar input[type="checkbox"]').forEach(cb => cb.checked = false);

                    fetchProducts(categoryKey);
                });
            });

            document.querySelectorAll('#sidebar input').forEach(input => {
                input.addEventListener('change', applyFilters);
            });

            const defaultCategoryCard = document.querySelector('.category-card');
            if (defaultCategoryCard) {
                defaultCategoryCard.click();
            } else {
                renderProducts([]);
            }

            document.getElementById('accountBtn')?.addEventListener('click', function () {
                const token = localStorage.getItem('userToken');

                if (token) {
                    window.location.href = 'my-account.html';
                } else {
                    window.location.href = 'login.html';
                }
            });
        });
    </script>
</body>

</html>